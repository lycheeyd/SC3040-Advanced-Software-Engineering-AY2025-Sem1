# SC3040-Advanced-Software-Engineering

## About
**Calowin** is a mobile application designed to promote personal fitness and environmental sustainability by integrating active travel tracking with carbon savings quantification.

We decided to create Calowin to fill a critical gap in the market. While existing navigation apps ignore environmental impact and fitness apps do not include navigation capabilities, there is no single platform that connects them. Hence, Calowin bridges this gap by empowering users to track both the calories they burn and the carbon emissions they save during their trips. 

Ultimately, the app aims to motivate individuals to make healthier, more eco-friendly choices, turning everyday travel into a rewarding experience for both personal well-being and the environment. 

#### For Calowin Application Demo Video, see [Video](https://youtu.be/u8qhtj0_VHI)

<br/>

## Contributors
| Name | GitHub Account |
| :---:         |     :---:      |
| Chua Yong Tai Anthony   | anthonycyt     |
| Liu Cong     | liuconggg       |
| Yi Da     | lycheeyd       |
| Ali   | ali-adi     |
| Fan Yu Pei     |   FAN0020     |
| Yu Jia     |  jiahuiyue      |

## Repository Layout

<details markdown="1"><summary>Repository Layout</summary>
  
- **CalowinAcount:**       Account Microservice
- **CalowinFriends:**      Friends Microservice
- **CalowinNotification:** Notification Microservice
- **CalowinSpringNode:**   API Gateway Microservice
- **CalowinTrip:**         Trip Microservice
- **CalowinWellnessZone:** WellnessZone Microservice
- **calowin_ui:**          Flutter Frontend Application
- **HF_setup_obsolete:**   Obsoleted initial non-CI/CD deployment setup structure (Record Keeping Purpose)
- **atomikos-logs:**       Backend Microservice logging destination for local development

</details>

<br/>

# System Overview and Setup Details

> [!NOTE]
> ### Prerequisites
> - Java 21
> - Maven 3.6+
> - Flutter SDK 3.0+
> - HuggingFace Space (HF) [Docker Build]
> - Git
> - Microsoft SQL Server 2022
> - SQL Server Management Studio

## Architecture
- **Backend**: 5 Spring Boot microservices + 1 Spring Boot API Gateway (Hosted on HuggingFace)
- **Frontend**: Flutter Based Mobile & Web application
- **Database**: Microsoft SQL Server 2022 (Hosted on NTU's Virtual Machine behind a VPN)

## Frontend Setup

<details markdown="1"><summary>Frontend Setup</summary>

### 1. Direct installation (Recommended)
  - **Android:** Download and install Calowin using the APK file provided. It can be found in the CalowinUI Installation Files folder. 
  - **iOS:** An .ipa file for direct installation on iOS devices cannot be provided. Generating and distributing .ipa files requires an Apple Developer Program subscription, which is a paid service. iOS users who wish to test the application must build it manually using Xcode 

### 2. Manual

#### 1. Prerequisites for Manual Setup
- Flutter SDK 3.0+ (see Prerequisites section)
- **Android:** Studio with Android SDK Tools
- **iOS:** Xcode and iOS SDK (macOS only)

#### 2. Android Emulator
- Android Studio's Android Emulator (latest stable version)
- Minimum Android API Level 21 (Android 5.0 Lollipop) or higher
- Recommended: API Level 30+ for optimal performance
- Ensure Google Play Services are available for Maps functionality
      
#### 3. iOS Simulator
- Xcode iOS Simulator (latest stable version)
- Minimum iOS 15.6 or higher
- Requires macOS with Xcode installed

</details>

<br/>

## Backend Setup

<details markdown="1"><summary>Backend Setup</summary>

### 1. HuggingFace Requirements
- All backend services are configured to use port 7860 as mandated by HuggingFace
- All service must await and respond to "/" Get request from HuggingFace to complete container startup
- HuggingFace adopts Readme.md file as configuration file for Space's metadata

### 2. HuggingFace Secrets
- Github fine grained Personal Access Token (PAT):  Read access to actions, code, and metadata

### 3. HuggingFace Variables (Dynamically injected)
- Github Repository
- Service Name
- Build_ID

### 4. HuggingFace Configuration Files
- Dockerfile (Same across all services)
- Readme.md (Unique per service) - Provides description and metadata for each HuggingFace Space
- Build-Vars.env (Hold variables in #3, dynamically generated by CI/CD pipeline)

### 5. MicroService Naming Convention
This naming convention must be adhered for naming Service Folders in GitHub and creating Spaces on HuggingFace
- **HF Staging Environments (UAT Branch):** Calowin{SERVICENAME}
- **HF Production Environments (Main Branch):** Calowin{SERVICENAME}Live
- **GitHub Folders:** {SERVICENAME} (Placed in Root Directory)

- Horizontal Scale Out (Future): {EnvironmentName}-N (where N is integer with increment of 1) [E.g. CalowinAccount-1]

### 6. HuggingFace Space Setup
Create a HF space following the specified **naming convention** with the following options:
- Docker SDK
- Blank template
- Public

### 7. Extra notes
- Email generation uses Google OAuth + Gmail API instead of Gmail SMTP, while both are available due to SMTP port restriction by HuggingFace.
- A Bastion Server is setup to bypass VPN wall by SSH tunneling for establishing connection to the Virtual Machine hosting the database

</details>

<br/>

## GitHub Deployment Setup

<details markdown="1"><summary>GitHub Deployment Setup</summary>
  
### 1. GitHub Secrets
- Github fine grained PAT:
  - Read access to metadata
  - Read and Write access to actions variables and code
    
- HuggingFace Access Token
- HuggingFace Username

### 2. GitHub Environments
- UAT
- Production

### 3. GitHub Variables (Automated by CI/CD)
#### 1. UAT Environment
 - List of successful Build_ID(s) for version based deployment on HuggingFace and tracking
 - **Variable Name Generation Convention**:
   - BUILD_ID_{SERVICENAME}_{short_commit_SHA}

#### 2. Production Environment
 - Tracks the current version (Build_ID) deployed on HF production environments
 - **Variable Name Generation Convention**:
   - LAST_BUILD_ID_{SERVICENAME}

### 4. CI/CD Pipeline Workflows
- **Automatic Deployment:** deploy-services-v3.yml
  - Triggered On pull-request completion into UAT branch and main branch
    
- **Manual Deployment:** manual-full-deploy-services.yml
  - Options available to deploy each services individually OR All

- **Erase the Artifact Library:** purge.yml

<img width="1026" height="428" alt="image" src="https://github.com/user-attachments/assets/1b513921-dfae-429c-8f23-d2ac215bc253" />

</details>

<br/>

## Database Setup

<details markdown="1"><summary>Database Setup</summary>

### 1. Databases
- **CalowinDB:** Stores application level data
  
  <details markdown="1"><summary>Tables(s)</summary>
    
  - **UserInfo:**
    | Column Name | Data Type |
    | :---:       |     :---:      |
    user_id	| nchar(8)
    name | nvarchar(50)
    weight | float
    bio	| nvarchar(250)
	
  - **Trips:**
    | Column Name | Data Type |
    | :---:       |     :---:      |
    trip_id | nvarchar(10)
    start_location | nvarchar(255)
    end_location | nvarchar(255)
    start_longitude | decimal(18, 7)
    start_latitude | decimal(18, 7)
    end_longitude | decimal(18, 7)
    end_latitude | decimal(18, 7)
    distance | decimal(5, 3)
    calories_burnt | int
    carbon_saved | int
    trip_time | datetime2(7)
    travel_method | nvarchar(20)
    status | nvarchar(20)
    user_id | nchar(8)

  - **Achievement:**
    | Column Name | Data Type |
    | :---:       |     :---:      |
    user_id	| nchar(8)
    total_carbon_saved	| int
    total_calorie_burnt	| int
    carbon_medal	| nvarchar(50)
    calorie_medal	| nvarchar(50)
	
  - **FriendRelationship:**
    | Column Name | Data Type |
    | :---:       |     :---:      |
    Unique_ID	| nvarchar(8)
    Friend_Unique_ID	| nvarchar(8)
    [Friended On]	| datetime2(7)
    status	| varchar(20)
	
  </details>
    
- **CalowinSecureDB:** Stores user and system confidential data with security implementations

  <details markdown="1"><summary>Tables(s)</summary>
    
  - **OTPRegister:**
    | Column Name | Data Type |
    | :---:       |     :---:      |
    email	| nchar(255)
    otp_code	| nchar(6)
    expires_at	| datetime2(7)
    otp_type	| nchar(20)
    
  - **SecureUserInfo:**
    | Column Name | Data Type |
    | :---:       |     :---:      |
    user_id	| nchar(8)
    email_address	| nchar(255)
    password	| nvarchar(255)
	
  - **ApiKeys:**
    | Column Name | Data Type |
    | :---:       |     :---:      |
    KeyId	| int
    KeyName	| nvarchar(100)
    ApiKey	| nvarchar(MAX)

### 2. Bastion SSH Tunneling
NTU Virtual machine hosting the SQL database server will SSH into Azure Bastion, creating a reverse SSH tunnel to route read/write requests from HuggingFace backend services to the respective databases.

  </details>

<br/>

## External API(s)

<details markdown="1"><summary>External API(s)</summary>
  
- **Google Cloud API(s):**
  - Google OAuth2
  - Gmail API
  - Gmail SMTP
  - Google Maps JavaScript API
  - Google Maps SDK for Android
  - Google Maps SDK for IOS
  - Directions API
  - Places API
  - Places API (New)

- **data.gov.sg API(s):**
  - NEA Weather API (https://data.gov.sg/collections/1459/view)
  - NPARKS Parks API (https://data.gov.sg/datasets/d_0542d48f0991541706b58059381a6eca/view)

</details>

<br/>
